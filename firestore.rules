rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Goals collection - users can only access their own goals
    match /goals/{goalId} {
      allow read: if request.auth != null
        && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null
        && request.auth.uid == request.resource.data.userId;
      allow update, delete: if request.auth != null
        && request.auth.uid == resource.data.userId;
    }

    // Sessions collection - users can only access their own sessions
    match /sessions/{sessionId} {
      allow read: if request.auth != null
        && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null
        && request.auth.uid == request.resource.data.userId;
      allow update, delete: if request.auth != null
        && request.auth.uid == resource.data.userId;
    }

    // Repertoire collection - users can only access their own pieces
    match /repertoire/{pieceId} {
      allow read: if request.auth != null
        && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null
        && request.auth.uid == request.resource.data.userId;
      allow update, delete: if request.auth != null
        && request.auth.uid == resource.data.userId;
    }

    // Scale skills collection - users can only access their own scale skills
    match /scaleSkills/{skillId} {
      allow read: if request.auth != null
        && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null
        && request.auth.uid == request.resource.data.userId;
      allow update, delete: if request.auth != null
        && request.auth.uid == resource.data.userId;
    }

    // Ear training collection - users can only access their own ear training data
    match /earTraining/{trainingId} {
      allow read: if request.auth != null
        && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null
        && request.auth.uid == request.resource.data.userId;
      allow update, delete: if request.auth != null
        && request.auth.uid == resource.data.userId;
    }

    // User preferences collection - users can only access their own preferences
    match /userPreferences/{preferenceId} {
      allow read: if request.auth != null
        && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null
        && request.auth.uid == request.resource.data.userId;
      allow update, delete: if request.auth != null
        && request.auth.uid == resource.data.userId;
    }

    // Practice goals collection - users can only access their own practice goals
    match /practiceGoals/{practiceGoalId} {
      allow get: if request.auth != null
        && request.auth.uid == resource.data.userId;
      allow list: if request.auth != null;
      allow create: if request.auth != null
        && request.auth.uid == request.resource.data.userId;
      allow update, delete: if request.auth != null
        && request.auth.uid == resource.data.userId;
    }
  }
}
